# FastAPI Reqres

Микросервис на FastAPI с автотестами.

## Установка и запуск

### 1. Установка зависимостей

```bash
# Установка Poetry (если еще не установлен)
curl -sSL https://install.python-poetry.org | python3 -

# Установка зависимостей проекта
poetry install
```

### 2. Настройка окружения

Создайте `.env` файл в корне проекта:

| Переменная | Описание                     | Значение по умолчанию | Обязательно |
|------------|------------------------------|-----------------------|-------------|
| HOST       | IP адрес для запуска сервера | 0.0.0.0               | Нет         |
| PORT       | Порт для запуска сервера     | 8000                  | Нет         |
| API_URL    | Базовый URL для тестов       | http://localhost:8000 | Да          |

Пример `.env`:

```bash
HOST=0.0.0.0
PORT=8000
API_URL=http://localhost:8000
API_KEY=reqres-free-v1
```

**Важно:** Если сервис недоступен, тесты автоматически остановятся с сообщением о проблеме.

### 3. Запуск сервера

```bash
# Через Poetry
poetry run python app/main.py

# Или активировать виртуальное окружение
poetry shell
python app/main.py
```

Сервер: http://localhost:8000

### 4. Запуск тестов

```bash
# Все тесты
pytest tests/ -v

# По маркерам
poetry run pytest -m smoke          # Smoke тесты
poetry run pytest -m auth           # Аутентификация  
poetry run pytest -m crud           # CRUD операции
poetry run pytest -m pagination     # Пагинация
poetry run pytest -m "not slow"     # Исключить медленные

# Конкретный файл
poetry run pytest tests/test_auth.py -v
```

## API

Сервер автоматически генерирует интерактивную документацию:

- **Swagger UI:** http://localhost:8000/docs
- **ReDoc:** http://localhost:8000/redoc

### Основные эндпоинты:

- `GET /status` - Статус приложения
- `GET /api/users` - Список пользователей (с пагинацией и delay)
- `POST /api/register` - Регистрация (с валидацией email)
- `POST /api/login` - Вход в систему
- `GET /api/unknown` - Список ресурсов

**Полный список эндпоинтов смотрите в Swagger UI**

## Структура проекта

```
├── app/
│   ├── main.py              # FastAPI сервер
│   └── models.py            # Pydantic модели для валидации
├── tests/
│   ├── test_auth.py         # Тесты аутентификации
│   ├── test_crud.py         # CRUD операции
│   ├── test_resources.py    # Тесты ресурсов
│   ├── test_smoke.py        # Smoke тесты
│   ├── test_special.py      # Специальные тесты (delayed response)
│   ├── test_users.py        # Тесты пользователей
│   ├── conftest.py          # Pytest фикстуры
│   └── assertions.py        # Хелперы для проверок в тестах
├── pyproject.toml           # Poetry конфигурация и зависимости
├── poetry.lock              # Закрепленные версии зависимостей
├── .env                     # Переменные окружения
├── .gitignore              # Git ignore файл
├── api.log                 # Логи API (генерируется автоматически)
└── README.md               # Документация проекта
```

## Тесты

**Всего: ~40 тестов** разбитых по функциональным областям

### Покрытие:

-  **Smoke тесты** - доступность сервиса, статус приложения
-  **Аутентификация** - регистрация/логин с email валидацией
-  **CRUD операции** - создание/обновление/удаление пользователей
-  **Пользователи** - получение, пагинация, уникальность ID
-  **Ресурсы** - получение, пагинация ресурсов
-  **Специальные** - delayed response с измерением времени

## Особенности

- **Автоматическая проверка** доступности сервиса перед запуском тестов
- **Email валидация** с использованием `email-validator`
- **Delayed response** для тестирования с задержкой
- **Параметризованные тесты** для покрытия различных сценариев
- **Понятные сообщения об ошибках** вместо пустых ответов