# FastAPI Reqres

Микросервис на FastAPI с автотестами.

## Установка и запуск

### 1. Установка зависимостей

```bash
# Установка Poetry (если еще не установлен)
curl -sSL https://install.python-poetry.org | python3 -

# Установка зависимостей проекта
poetry install
```

### 2. Настройка окружения

Создайте `.env` файл в корне проекта:

```bash
# API Configuration
API_URL=http://localhost:8000
API_KEY=reqres-free-v1
HOST=0.0.0.0
PORT=8000
```

**Важно:** Если сервис недоступен, тесты автоматически остановятся с сообщением о проблеме.

### 3. Запуск сервера

```bash
# Через Poetry
poetry run python app/main.py

# Или активировать виртуальное окружение
poetry shell
python app/main.py
```

Сервер: http://localhost:8000

### 4. Запуск тестов

```bash
# Все тесты
poetry run pytest tests/ -v

# Только основные тесты
poetry run pytest tests/test_reqres.py -v

# Только smoke тесты
poetry run pytest tests/test_smoke.py -v
```

## API

### Статус

```
GET /status                          # Статус приложения
```

### Пользователи

```
GET /api/users?page=1&per_page=6     # Список пользователей
GET /api/users/2                     # Один пользователь
GET /api/users/999                   # 404 Not Found
POST /api/users                      # Создание пользователя  
PUT /api/users/2                     # Полное обновление
PATCH /api/users/2                   # Частичное обновление
DELETE /api/users/2                  # Удаление (204)
```

### Ресурсы

```
GET /api/unknown                     # Список ресурсов
GET /api/unknown/2                   # Один ресурс
GET /api/unknown/23                  # 404 Not Found
```

## Структура проекта

```
├── app/
│   ├── main.py              # FastAPI сервер
│   └── models.py            # Pydantic модели для валидации
├── tests/
│   ├── test_reqres.py       # Автотесты с Pydantic валидацией
│   ├── test_smoke.py        # Smoke тесты
│   ├── conftest.py          # Pytest фикстуры
│   └── assertions.py        # Хелперы для проверок в тестах
├── pyproject.toml           # Poetry конфигурация и зависимости
├── poetry.lock              # Закрепленные версии зависимостей
├── .env                     # Переменные окружения
├── .gitignore              # Git ignore файл
├── api.log                 # Логи API (генерируется автоматически)
└── README.md               # Документация проекта
```

## Тесты

**Smoke тесты:**

- ✅ Проверка доступности сервиса
- ✅ Статус приложения
- ✅ Основные эндпоинты

**Пользователи:**

- ✅ Список пользователей (пагинация)
- ✅ Получение пользователя по ID
- ✅ 404 для несуществующих пользователей
- ✅ Уникальность ID пользователей
- ✅ Создание пользователя (POST)
- ✅ Обновление пользователя (PUT/PATCH)
- ✅ Удаление пользователя (DELETE)

**Ресурсы:**

- ✅ Список ресурсов (пагинация)
- ✅ Получение ресурса по ID
- ✅ 404 для несуществующих ресурсов

Заготовки для будущего (не покрыто тестами):

- ❌ Аутентификация
- ❌ Задержанные ответы

## Особенности

- Автоматическая проверка доступности сервиса перед запуском тестов
- Тестовые данные генерируются с помощью `mimesis`
- Универсальные хелперы для проверок в `assertions.py`
- Структура файлов разделена на `app/` и `tests/`
- Автоматическая загрузка переменных окружения в тестах